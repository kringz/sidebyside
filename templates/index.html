{% extends 'layout.html' %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-dark">
                    <h2 class="card-title"><i class="fas fa-server me-2"></i>Trino Cluster Status</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Cluster 1 Status -->
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-header {% if cluster1_status == 'running' %}bg-success{% else %}bg-secondary{% endif %}">
                                    <h5 class="card-title text-white mb-0">
                                        <i class="fas {% if cluster1_status == 'running' %}fa-check-circle{% else %}fa-times-circle{% endif %} me-2"></i>
                                        Cluster 1 ({{ config.cluster1.version }})
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <p><strong>Status:</strong> <span class="badge {% if cluster1_status == 'running' %}bg-success{% else %}bg-secondary{% endif %}">{{ cluster1_status|capitalize }}</span></p>
                                    <p><strong>Port:</strong> {{ config.cluster1.port }}</p>
                                    <p><strong>Container:</strong> {{ config.cluster1.container_name }}</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Cluster 2 Status -->
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-header {% if cluster2_status == 'running' %}bg-success{% else %}bg-secondary{% endif %}">
                                    <h5 class="card-title text-white mb-0">
                                        <i class="fas {% if cluster2_status == 'running' %}fa-check-circle{% else %}fa-times-circle{% endif %} me-2"></i>
                                        Cluster 2 ({{ config.cluster2.version }})
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <p><strong>Status:</strong> <span class="badge {% if cluster2_status == 'running' %}bg-success{% else %}bg-secondary{% endif %}">{{ cluster2_status|capitalize }}</span></p>
                                    <p><strong>Port:</strong> {{ config.cluster2.port }}</p>
                                    <p><strong>Container:</strong> {{ config.cluster2.container_name }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Cluster Configuration Section -->
                <div class="card-body border-top">
                    <h4 class="card-title text-primary"><i class="fas fa-server me-2"></i>Cluster Configuration</h4>
                    <form action="{{ url_for('save_configuration') }}" method="post" class="mb-4" id="configForm" data-loading-message="Saving configuration...">
                        <!-- Docker Configuration Section -->
                        <div class="card mb-4">
                            <div class="card-header bg-dark text-white">
                                <h5 class="mb-0"><i class="fab fa-docker me-2"></i>Docker Connection Settings</h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Mac Users:</strong> If you're using Docker Desktop for Mac, set "Trino Connect Host" to <code>host.docker.internal</code>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="docker_trino_connect_host" class="form-label">Trino Connect Host</label>
                                            <input type="text" class="form-control" id="docker_trino_connect_host" name="docker_trino_connect_host" value="{{ config.docker.trino_connect_host }}" {% if not docker_available %}disabled{% endif %}>
                                            <small class="text-muted">Hostname that Trino clients use to connect to Trino containers, typically <code>localhost</code>.</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="docker_socket_path" class="form-label">Docker Socket Path (Advanced)</label>
                                            <input type="text" class="form-control" id="docker_socket_path" name="docker_socket_path" value="{{ config.docker.socket_path }}" placeholder="Leave empty for automatic detection" {% if not docker_available %}disabled{% endif %}>
                                            <small class="text-muted">E.g. <code>unix:///var/run/docker.sock</code> or <code>tcp://localhost:2375</code></small>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="docker_timeout" class="form-label">Docker Operation Timeout (seconds)</label>
                                            <input type="number" class="form-control" id="docker_timeout" name="docker_timeout" value="{{ config.docker.timeout }}" min="10" max="300" {% if not docker_available %}disabled{% endif %}>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3 mt-4">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="docker_auto_pull_images" name="docker_auto_pull_images" {% if config.docker.auto_pull_images %}checked{% endif %} {% if not docker_available %}disabled{% endif %}>
                                                <label class="form-check-label" for="docker_auto_pull_images">
                                                    Automatically pull Docker images when versions change
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Cluster 1 Configuration -->
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0">Cluster 1 Configuration</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="cluster1_version" class="form-label">Trino Version</label>
                                            <input type="text" class="form-control" id="cluster1_version" name="cluster1_version" value="{{ config.cluster1.version }}" {% if not docker_available %}disabled{% endif %}>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="cluster1_port" class="form-label">Port</label>
                                            <input type="number" class="form-control" id="cluster1_port" name="cluster1_port" value="{{ config.cluster1.port }}" min="1024" max="65535" {% if not docker_available %}disabled{% endif %}>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="cluster1_container_name" class="form-label">Container Name</label>
                                            <input type="text" class="form-control" id="cluster1_container_name" name="cluster1_container_name" value="{{ config.cluster1.container_name }}" {% if not docker_available %}disabled{% endif %}>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Cluster 2 Configuration -->
                        <div class="card mb-4">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="mb-0">Cluster 2 Configuration</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="cluster2_version" class="form-label">Trino Version</label>
                                            <input type="text" class="form-control" id="cluster2_version" name="cluster2_version" value="{{ config.cluster2.version }}" {% if not docker_available %}disabled{% endif %}>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="cluster2_port" class="form-label">Port</label>
                                            <input type="number" class="form-control" id="cluster2_port" name="cluster2_port" value="{{ config.cluster2.port }}" min="1024" max="65535" {% if not docker_available %}disabled{% endif %}>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="cluster2_container_name" class="form-label">Container Name</label>
                                            <input type="text" class="form-control" id="cluster2_container_name" name="cluster2_container_name" value="{{ config.cluster2.container_name }}" {% if not docker_available %}disabled{% endif %}>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i> Save Configuration
                            </button>
                            <button type="reset" class="btn btn-secondary ms-2">
                                <i class="fas fa-undo me-1"></i> Reset Form
                            </button>
                        </div>
                    </form>
                
                    <!-- Available Trino Images Section -->
                    <h4 class="mt-4 text-primary"><i class="fas fa-cube me-2"></i>Available Trino Images</h4>
                    {% if docker_available %}
                        {% if available_trino_images %}
                            <div class="row">
                                <div class="col-12">
                                    <div class="alert alert-info">
                                        <p><strong>Preloaded Images:</strong></p>
                                        <div class="d-flex flex-wrap">
                                            {% for version in available_trino_images %}
                                                <span class="badge bg-primary me-2 mb-2 p-2">
                                                    <i class="fas fa-cube me-1"></i> {{ version }}
                                                </span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <div class="alert alert-warning">
                                <i class="fas fa-info-circle me-2"></i> No Trino images found. Use the "Pull Images" button to download the required images.
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i> Docker is not available. Image management is disabled.
                        </div>
                    {% endif %}
                    
                    <!-- Image Pull Progress -->
                    <div class="row mb-3 d-none" id="imagePullProgress">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-spinner fa-spin me-2"></i> Pulling Trino Images
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div id="imagePullProgressBars"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Control buttons -->
                <div class="card-footer">
                    <div class="d-flex justify-content-center">
                        <form action="{{ url_for('pull_trino_images') }}" method="post" class="me-2" id="pullImagesForm" data-loading-message="Pulling Trino images... This may take several minutes.">
                            <div class="dropdown">
                                <button type="button" class="btn btn-info dropdown-toggle" id="pullImagesBtn" data-bs-toggle="dropdown" aria-expanded="false" {% if not docker_available %}disabled{% endif %}>
                                    <i class="fas fa-download me-1"></i> Pull Images
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="pullImagesBtn">
                                    <li><button type="button" class="dropdown-item" id="pullAllImagesBtn">Pull Both Configured Images</button></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><button type="button" class="dropdown-item pull-version-btn" data-version="{{ config.cluster1.version }}">Pull Cluster 1 ({{ config.cluster1.version }}) Image</button></li>
                                    <li><button type="button" class="dropdown-item pull-version-btn" data-version="{{ config.cluster2.version }}">Pull Cluster 2 ({{ config.cluster2.version }}) Image</button></li>
                                </ul>
                            </div>
                        </form>
                        <form action="{{ url_for('start_clusters') }}" method="post" class="me-2" data-loading-message="Starting Trino clusters... This may take a minute.">
                            <button type="submit" class="btn btn-success" {% if not docker_available %}disabled{% endif %}>
                                <i class="fas fa-play me-1"></i> Start Clusters
                            </button>
                        </form>
                        <form action="{{ url_for('stop_clusters') }}" method="post" class="me-2" data-loading-message="Stopping Trino clusters...">
                            <button type="submit" class="btn btn-danger" {% if not docker_available %}disabled{% endif %}>
                                <i class="fas fa-stop me-1"></i> Stop Clusters
                            </button>
                        </form>
                        <form action="{{ url_for('restart_clusters') }}" method="post" data-loading-message="Restarting Trino clusters... This may take a minute.">
                            <button type="submit" class="btn btn-warning" {% if not docker_available %}disabled{% endif %}>
                                <i class="fas fa-redo me-1"></i> Restart Clusters
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- CATALOG CONFIGURATION SECTION -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary">
                    <h2 class="card-title text-white"><i class="fas fa-cogs me-2"></i>Catalog Configuration</h2>
                </div>
                <div class="card-body">
                    {% if not docker_available %}
                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Docker is not available in this environment.</strong> You can configure catalogs, but they cannot be used with Trino clusters in demo mode.
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                    {% endif %}
                    <form action="{{ url_for('save_catalog_config') }}" method="post" data-loading-message="Saving catalog configuration...">
                        <!-- TPC-H Catalog -->
                        <div class="card mb-4 border-info">
                            <div class="card-header bg-info text-white">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="tpch" name="tpch" checked disabled 
                                           {% if cluster1_status == 'running' or cluster2_status == 'running' %}readonly{% endif %}
                                           data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="TPC-H is always enabled when clusters are running for basic functionality.">
                                    <input type="hidden" name="tpch" value="on">
                                    <label class="form-check-label" for="tpch">
                                        <h5 class="mb-0">TPC-H Catalog</h5>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="tpch_column_naming" class="form-label">Column Naming Style</label>
                                            <select class="form-select" id="tpch_column_naming" name="tpch_column_naming">
                                                <option value="SIMPLIFIED" {% if config.catalogs.tpch.column_naming == 'SIMPLIFIED' %}selected{% endif %}>Simplified</option>
                                                <option value="STANDARD" {% if config.catalogs.tpch.column_naming == 'STANDARD' %}selected{% endif %}>Standard</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-success">
                                    <i class="fas fa-check-circle me-2"></i>
                                    <strong>Ready to use!</strong> TPC-H is a built-in catalog that doesn't require external services. 
                                    Available tables: customer, orders, lineitem, part, partsupp, supplier, nation, region.
                                </div>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Usage example:</strong> <code>SELECT * FROM tpch.tiny.customer LIMIT 10</code>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Hive Catalog -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="hive" name="hive" {% if config.catalogs.hive.enabled %}checked{% endif %}>
                                    <label class="form-check-label" for="hive">
                                        <h5 class="mb-0">Hive Catalog</h5>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="hive_metastore_host" class="form-label">Metastore Host</label>
                                            <input type="text" class="form-control" id="hive_metastore_host" name="hive_metastore_host" value="{{ config.catalogs.hive.metastore_host }}">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="hive_metastore_port" class="form-label">Metastore Port</label>
                                            <input type="text" class="form-control" id="hive_metastore_port" name="hive_metastore_port" value="{{ config.catalogs.hive.metastore_port }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Note:</strong> For a local setup, you may need to run a separate Hive metastore service.
                                </div>
                            </div>
                        </div>
                        
                        <!-- Iceberg Catalog -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="iceberg" name="iceberg" {% if config.catalogs.iceberg.enabled %}checked{% endif %}>
                                    <label class="form-check-label" for="iceberg">
                                        <h5 class="mb-0">Iceberg Catalog</h5>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="iceberg_metastore_host" class="form-label">Metastore Host</label>
                                            <input type="text" class="form-control" id="iceberg_metastore_host" name="iceberg_metastore_host" value="{{ config.catalogs.iceberg.metastore_host }}">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="iceberg_metastore_port" class="form-label">Metastore Port</label>
                                            <input type="text" class="form-control" id="iceberg_metastore_port" name="iceberg_metastore_port" value="{{ config.catalogs.iceberg.metastore_port }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Note:</strong> Iceberg uses Hive metastore for catalog storage. Ensure your metastore is compatible with Iceberg tables.
                                </div>
                            </div>
                        </div>
                        
                        <!-- Delta Lake Catalog -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="delta-lake" name="delta-lake" {% if config.catalogs['delta-lake'].enabled %}checked{% endif %}>
                                    <label class="form-check-label" for="delta-lake">
                                        <h5 class="mb-0">Delta Lake Catalog</h5>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="delta-lake_metastore_host" class="form-label">Metastore Host</label>
                                            <input type="text" class="form-control" id="delta-lake_metastore_host" name="delta-lake_metastore_host" value="{{ config.catalogs['delta-lake'].metastore_host }}">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="delta-lake_metastore_port" class="form-label">Metastore Port</label>
                                            <input type="text" class="form-control" id="delta-lake_metastore_port" name="delta-lake_metastore_port" value="{{ config.catalogs['delta-lake'].metastore_port }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Note:</strong> Delta Lake uses Hive metastore for catalog storage. Ensure your metastore is compatible with Delta Lake tables.
                                </div>
                            </div>
                        </div>
                        
                        <!-- MySQL Catalog -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="mysql" name="mysql" {% if config.catalogs.mysql.enabled %}checked{% endif %}>
                                    <label class="form-check-label" for="mysql">
                                        <h5 class="mb-0">MySQL Catalog</h5>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="mysql_host" class="form-label">Host</label>
                                            <input type="text" class="form-control" id="mysql_host" name="mysql_host" value="{{ config.catalogs.mysql.host }}">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="mysql_port" class="form-label">Port</label>
                                            <input type="text" class="form-control" id="mysql_port" name="mysql_port" value="{{ config.catalogs.mysql.port }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="mysql_user" class="form-label">User</label>
                                            <input type="text" class="form-control" id="mysql_user" name="mysql_user" value="{{ config.catalogs.mysql.user }}">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="mysql_password" class="form-label">Password</label>
                                            <input type="password" class="form-control" id="mysql_password" name="mysql_password" value="{{ config.catalogs.mysql.password }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Note:</strong> You need a running MySQL server accessible from the Trino containers.
                                </div>
                            </div>
                        </div>
                        
                        <!-- MariaDB Catalog -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="mariadb" name="mariadb" {% if config.catalogs.mariadb.enabled %}checked{% endif %}>
                                    <label class="form-check-label" for="mariadb">
                                        <h5 class="mb-0">MariaDB Catalog</h5>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="mariadb_host" class="form-label">Host</label>
                                            <input type="text" class="form-control" id="mariadb_host" name="mariadb_host" value="{{ config.catalogs.mariadb.host }}">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="mariadb_port" class="form-label">Port</label>
                                            <input type="text" class="form-control" id="mariadb_port" name="mariadb_port" value="{{ config.catalogs.mariadb.port }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="mariadb_user" class="form-label">User</label>
                                            <input type="text" class="form-control" id="mariadb_user" name="mariadb_user" value="{{ config.catalogs.mariadb.user }}">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="mariadb_password" class="form-label">Password</label>
                                            <input type="password" class="form-control" id="mariadb_password" name="mariadb_password" value="{{ config.catalogs.mariadb.password }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Note:</strong> You need a running MariaDB server accessible from the Trino containers.
                                </div>
                            </div>
                        </div>
                        
                        <!-- PostgreSQL Catalog -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="postgres" name="postgres" {% if config.catalogs.postgres.enabled %}checked{% endif %}>
                                    <label class="form-check-label" for="postgres">
                                        <h5 class="mb-0">PostgreSQL Catalog</h5>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="postgres_host" class="form-label">Host</label>
                                            <input type="text" class="form-control" id="postgres_host" name="postgres_host" value="{{ config.catalogs.postgres.host }}">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="postgres_port" class="form-label">Port</label>
                                            <input type="text" class="form-control" id="postgres_port" name="postgres_port" value="{{ config.catalogs.postgres.port }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="postgres_database" class="form-label">Database</label>
                                            <input type="text" class="form-control" id="postgres_database" name="postgres_database" value="{{ config.catalogs.postgres.database }}">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="postgres_user" class="form-label">User</label>
                                            <input type="text" class="form-control" id="postgres_user" name="postgres_user" value="{{ config.catalogs.postgres.user }}">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="postgres_password" class="form-label">Password</label>
                                            <input type="password" class="form-control" id="postgres_password" name="postgres_password" value="{{ config.catalogs.postgres.password }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Note:</strong> You need a running PostgreSQL server accessible from the Trino containers.
                                </div>
                            </div>
                        </div>
                        
                        <!-- SQL Server Catalog -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="sqlserver" name="sqlserver" {% if config.catalogs.sqlserver.enabled %}checked{% endif %}>
                                    <label class="form-check-label" for="sqlserver">
                                        <h5 class="mb-0">SQL Server Catalog</h5>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="sqlserver_host" class="form-label">Host</label>
                                            <input type="text" class="form-control" id="sqlserver_host" name="sqlserver_host" value="{{ config.catalogs.sqlserver.host }}">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="sqlserver_port" class="form-label">Port</label>
                                            <input type="text" class="form-control" id="sqlserver_port" name="sqlserver_port" value="{{ config.catalogs.sqlserver.port }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="sqlserver_database" class="form-label">Database</label>
                                            <input type="text" class="form-control" id="sqlserver_database" name="sqlserver_database" value="{{ config.catalogs.sqlserver.database }}">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="sqlserver_user" class="form-label">User</label>
                                            <input type="text" class="form-control" id="sqlserver_user" name="sqlserver_user" value="{{ config.catalogs.sqlserver.user }}">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="sqlserver_password" class="form-label">Password</label>
                                            <input type="password" class="form-control" id="sqlserver_password" name="sqlserver_password" value="{{ config.catalogs.sqlserver.password }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Note:</strong> You need a running SQL Server accessible from the Trino containers.
                                </div>
                            </div>
                        </div>
                        
                        <!-- DB2 Catalog -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="db2" name="db2" {% if config.catalogs.db2.enabled %}checked{% endif %}>
                                    <label class="form-check-label" for="db2">
                                        <h5 class="mb-0">DB2 Catalog</h5>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="db2_host" class="form-label">Host</label>
                                            <input type="text" class="form-control" id="db2_host" name="db2_host" value="{{ config.catalogs.db2.host }}">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="db2_port" class="form-label">Port</label>
                                            <input type="text" class="form-control" id="db2_port" name="db2_port" value="{{ config.catalogs.db2.port }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="db2_database" class="form-label">Database</label>
                                            <input type="text" class="form-control" id="db2_database" name="db2_database" value="{{ config.catalogs.db2.database }}">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="db2_user" class="form-label">User</label>
                                            <input type="text" class="form-control" id="db2_user" name="db2_user" value="{{ config.catalogs.db2.user }}">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="db2_password" class="form-label">Password</label>
                                            <input type="password" class="form-control" id="db2_password" name="db2_password" value="{{ config.catalogs.db2.password }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Note:</strong> You need a running DB2 server accessible from the Trino containers.
                                </div>
                            </div>
                        </div>
                        
                        <!-- ClickHouse Catalog -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="clickhouse" name="clickhouse" {% if config.catalogs.clickhouse.enabled %}checked{% endif %}>
                                    <label class="form-check-label" for="clickhouse">
                                        <h5 class="mb-0">ClickHouse Catalog</h5>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="clickhouse_host" class="form-label">Host</label>
                                            <input type="text" class="form-control" id="clickhouse_host" name="clickhouse_host" value="{{ config.catalogs.clickhouse.host }}">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="clickhouse_port" class="form-label">Port</label>
                                            <input type="text" class="form-control" id="clickhouse_port" name="clickhouse_port" value="{{ config.catalogs.clickhouse.port }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="clickhouse_user" class="form-label">User</label>
                                            <input type="text" class="form-control" id="clickhouse_user" name="clickhouse_user" value="{{ config.catalogs.clickhouse.user }}">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="clickhouse_password" class="form-label">Password</label>
                                            <input type="password" class="form-control" id="clickhouse_password" name="clickhouse_password" value="{{ config.catalogs.clickhouse.password }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Note:</strong> You need a running ClickHouse server accessible from the Trino containers.
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pinot Catalog -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="pinot" name="pinot" {% if config.catalogs.pinot.enabled %}checked{% endif %}>
                                    <label class="form-check-label" for="pinot">
                                        <h5 class="mb-0">Pinot Catalog</h5>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="pinot_host" class="form-label">Host</label>
                                            <input type="text" class="form-control" id="pinot_host" name="pinot_host" value="{{ config.catalogs.pinot.host }}">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="pinot_port" class="form-label">Port</label>
                                            <input type="text" class="form-control" id="pinot_port" name="pinot_port" value="{{ config.catalogs.pinot.port }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Note:</strong> You need a running Pinot server accessible from the Trino containers.
                                </div>
                            </div>
                        </div>
                        
                        <!-- Elasticsearch Catalog -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="elasticsearch" name="elasticsearch" {% if config.catalogs.elasticsearch.enabled %}checked{% endif %}>
                                    <label class="form-check-label" for="elasticsearch">
                                        <h5 class="mb-0">Elasticsearch Catalog</h5>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="elasticsearch_host" class="form-label">Host</label>
                                            <input type="text" class="form-control" id="elasticsearch_host" name="elasticsearch_host" value="{{ config.catalogs.elasticsearch.host }}">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="elasticsearch_port" class="form-label">Port</label>
                                            <input type="text" class="form-control" id="elasticsearch_port" name="elasticsearch_port" value="{{ config.catalogs.elasticsearch.port }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Note:</strong> You need a running Elasticsearch server accessible from the Trino containers.
                                </div>
                            </div>
                        </div>
                        
                        <!-- Save button for catalog configuration -->
                        <div class="d-flex justify-content-between">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i> Save Catalog Configuration
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- LOCAL SETUP SECTION -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h2 class="card-title"><i class="fas fa-download me-2"></i>Local Setup</h2>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Download and run these scripts to quickly set up the Trino Comparison Tool on your local machine.
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header bg-primary text-white">
                                    <h4><i class="fab fa-linux me-2"></i><i class="fab fa-apple me-2"></i> For Mac/Linux</h4>
                                </div>
                                <div class="card-body">
                                    <p>Download and run the shell script to set up and launch the application:</p>
                                    <ol>
                                        <li>Download <a href="{{ url_for('static', filename='setup/start_app.sh') }}" class="btn btn-sm btn-outline-primary"><i class="fas fa-download me-1"></i>start_app.sh</a></li>
                                        <li>Open terminal in the download location</li>
                                        <li>Make it executable: <code>chmod +x start_app.sh</code></li>
                                        <li>Run it: <code>./start_app.sh</code></li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header bg-info text-white">
                                    <h4><i class="fab fa-windows me-2"></i> For Windows</h4>
                                </div>
                                <div class="card-body">
                                    <p>Download and run the batch file to set up and launch the application:</p>
                                    <ol>
                                        <li>Download <a href="{{ url_for('static', filename='setup/start_app.bat') }}" class="btn btn-sm btn-outline-info"><i class="fas fa-download me-1"></i>start_app.bat</a></li>
                                        <li>Double-click the downloaded file to run</li>
                                        <li>Or run it from Command Prompt: <code>start_app.bat</code></li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CLUSTER CONFIGURATION SECTION -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-info">
                    <h2 class="card-title text-white"><i class="fas fa-server me-2"></i>Cluster Configuration</h2>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('save_configuration') }}" method="post">
                        <!-- Docker Configuration Section -->
                        <div class="card mb-4">
                            <div class="card-header bg-dark text-white">
                                <h4 class="mb-0"><i class="fab fa-docker me-2"></i>Docker Connection Settings</h4>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Mac Users:</strong> If you're using Docker Desktop for Mac, set "Trino Connect Host" to <code>host.docker.internal</code>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="docker_trino_connect_host" class="form-label">Trino Connect Host</label>
                                            <input type="text" class="form-control" id="docker_trino_connect_host" name="docker_trino_connect_host" 
                                                value="{{ config.docker.trino_connect_host if config.docker and config.docker.trino_connect_host else 'localhost' }}">
                                            <small class="form-text text-muted">Hostname used by clients to connect to Trino servers</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="docker_socket_path" class="form-label">Docker Socket Path (Optional)</label>
                                            <input type="text" class="form-control" id="docker_socket_path" name="docker_socket_path" 
                                                value="{{ config.docker.socket_path if config.docker and config.docker.socket_path }}">
                                            <small class="form-text text-muted">Leave empty for auto-detection</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="docker_timeout" class="form-label">Docker Timeout (seconds)</label>
                                            <input type="number" class="form-control" id="docker_timeout" name="docker_timeout" 
                                                value="{{ config.docker.timeout if config.docker and config.docker.timeout else 30 }}" min="5" max="300">
                                            <small class="form-text text-muted">Increase for slow networks</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check form-switch mt-4">
                                            <input class="form-check-input" type="checkbox" id="docker_auto_pull_images" name="docker_auto_pull_images" 
                                                {% if config.docker and config.docker.auto_pull_images %}checked{% endif %}>
                                            <label class="form-check-label" for="docker_auto_pull_images">
                                                Automatically pull images when versions change
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <h4>Cluster 1</h4>
                                <div class="mb-3">
                                    <label for="cluster1_version" class="form-label">Version</label>
                                    <input type="text" class="form-control" id="cluster1_version" name="cluster1_version" value="{{ config.cluster1.version }}" required>
                                    <small class="form-text text-muted">e.g., 405, 406, latest</small>
                                </div>
                                <div class="mb-3">
                                    <label for="cluster1_port" class="form-label">Port</label>
                                    <input type="number" class="form-control" id="cluster1_port" name="cluster1_port" value="{{ config.cluster1.port }}" required>
                                </div>
                                <div class="mb-3">
                                    <label for="cluster1_container_name" class="form-label">Container Name</label>
                                    <input type="text" class="form-control" id="cluster1_container_name" name="cluster1_container_name" value="{{ config.cluster1.container_name }}" required>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <h4>Cluster 2</h4>
                                <div class="mb-3">
                                    <label for="cluster2_version" class="form-label">Version</label>
                                    <input type="text" class="form-control" id="cluster2_version" name="cluster2_version" value="{{ config.cluster2.version }}" required>
                                    <small class="form-text text-muted">e.g., 405, 406, latest</small>
                                </div>
                                <div class="mb-3">
                                    <label for="cluster2_port" class="form-label">Port</label>
                                    <input type="number" class="form-control" id="cluster2_port" name="cluster2_port" value="{{ config.cluster2.port }}" required>
                                </div>
                                <div class="mb-3">
                                    <label for="cluster2_container_name" class="form-label">Container Name</label>
                                    <input type="text" class="form-control" id="cluster2_container_name" name="cluster2_container_name" value="{{ config.cluster2.container_name }}" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i> Save Configuration
                            </button>
                            <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#resetConfigModal">
                                <i class="fas fa-undo me-1"></i> Reset to Defaults
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Reset Configuration Modal -->
<div class="modal fade" id="resetConfigModal" tabindex="-1" aria-labelledby="resetConfigModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="resetConfigModalLabel">Reset Configuration</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to reset all configuration settings to their default values?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form action="{{ url_for('reset_config') }}" method="post" data-loading-message="Resetting configuration to defaults...">
                    <button type="submit" class="btn btn-danger">Reset</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Pull Images Modal -->
<div class="modal fade" id="pullImagesModal" tabindex="-1" aria-labelledby="pullImagesModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="pullImagesModalLabel">Pull Trino Images</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Pulling Trino Docker images for versions:</p>
                <ul>
                    <li>Trino {{ config.cluster1.version }} (Cluster 1)</li>
                    <li>Trino {{ config.cluster2.version }} (Cluster 2)</li>
                </ul>
                <div class="progress mt-3 mb-3" style="height: 25px;">
                    <div id="pullProgressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                </div>
                <div id="pullStatus" class="alert alert-info">
                    Preparing to pull images...
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="cancelPullBtn">Cancel</button>
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    // Handle image pulling
    $('#pullImagesBtn').click(function() {
        // Show the modal
        var pullImagesModal = new bootstrap.Modal(document.getElementById('pullImagesModal'));
        pullImagesModal.show();
        
        // Set progress bar to 10%
        $('#pullProgressBar').css('width', '10%').attr('aria-valuenow', 10).text('10%');
        $('#pullStatus').html('<i class="fas fa-spinner fa-spin me-2"></i>Sending request to pull Trino images...');
        
        // Send AJAX request to pull images
        $.ajax({
            url: '{{ url_for("pull_trino_images") }}',
            type: 'POST',
            dataType: 'json',
            success: function(response) {
                if (response.success) {
                    // Success - show 100% in progress bar
                    $('#pullProgressBar').removeClass('bg-danger').addClass('bg-success').css('width', '100%').attr('aria-valuenow', 100).text('100%');
                    $('#pullStatus').removeClass('alert-info alert-danger').addClass('alert-success').html('<i class="fas fa-check-circle me-2"></i>' + response.message);
                    
                    // Change cancel button to done
                    $('#cancelPullBtn').text('Done');
                } else {
                    // Error - show error in progress bar
                    $('#pullProgressBar').removeClass('bg-success').addClass('bg-danger').css('width', '100%').attr('aria-valuenow', 100).text('Failed');
                    $('#pullStatus').removeClass('alert-info alert-success').addClass('alert-danger').html('<i class="fas fa-exclamation-circle me-2"></i>' + response.message);
                    
                    // Change cancel button to close
                    $('#cancelPullBtn').text('Close');
                }
            },
            error: function(xhr, status, error) {
                // Network error
                $('#pullProgressBar').removeClass('bg-success').addClass('bg-danger').css('width', '100%').attr('aria-valuenow', 100).text('Failed');
                $('#pullStatus').removeClass('alert-info alert-success').addClass('alert-danger').html('<i class="fas fa-exclamation-circle me-2"></i>Error contacting server: ' + error);
                
                // Change cancel button to close
                $('#cancelPullBtn').text('Close');
            }
        });
        
        // Simulate progress (this is just for UX since we don't have real-time progress updates)
        var progress = 10;
        var progressInterval = setInterval(function() {
            if (progress < 90) {
                progress += 5;
                $('#pullProgressBar').css('width', progress + '%').attr('aria-valuenow', progress).text(progress + '%');
                
                if (progress === 30) {
                    $('#pullStatus').html('<i class="fas fa-spinner fa-spin me-2"></i>Downloading Trino images from Docker Hub...');
                } else if (progress === 60) {
                    $('#pullStatus').html('<i class="fas fa-spinner fa-spin me-2"></i>Extracting image layers...');
                }
            } else {
                clearInterval(progressInterval);
            }
        }, 1000);
    });
});
</script>
{% endblock %}